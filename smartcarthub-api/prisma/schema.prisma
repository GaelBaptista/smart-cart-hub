// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "sqlite"
}

//
// ============================================
// TABELAS DE USU√ÅRIOS E LOJAS
// ============================================
//

// Gerente, funcion√°rio, etc.
model User {
  id            Int          @id @default(autoincrement())
  name          String
  email         String       @unique
  password      String
  role          Role         @default(GERENTE)
  supermarket   Supermarket? @relation(fields: [supermarketId], references: [id])
  supermarketId Int?
  createdAt     DateTime     @default(now())
}

// Permite expans√£o de perfis (ex: REPOSITOR, CAIXA)
enum Role {
  GERENTE
  CLIENTE
}


// Cada loja √© um supermercado (com se√ß√µes e produtos pr√≥prios)
model Supermarket {
  id        Int       @id @default(autoincrement())
  name      String
  address   String?
  sections  Section[]
  users     User[]
  carts     Cart[]
  createdAt DateTime  @default(now())
}

//
// ============================================
// TABELAS DE PRODUTOS E SE√á√ïES
// ============================================
//

// Se√ß√£o (ex: Padaria, Hortifr√∫ti, Latic√≠nios)
model Section {
  id             Int          @id @default(autoincrement())
  name           String
  position       Int?         // opcional, pode ser nulo
  supermarketId  Int
  supermarket    Supermarket  @relation(fields: [supermarketId], references: [id])
  products       Product[]
  createdAt      DateTime     @default(now())
}




// Produto
model Product {
  id          Int        @id @default(autoincrement())
  name        String
  brand       String?
  section     Section    @relation(fields: [sectionId], references: [id])
  sectionId   Int
  stock       Int        @default(0)
  isAvailable Boolean    @default(true)
  cartItems   CartItem[]
  ruptures    Rupture[]
  createdAt   DateTime   @default(now())
}


//
// ============================================
// TABELAS DE CARRINHO E INTERA√á√ÉO DO CLIENTE
// ============================================
//

model Cart {
  id           Int         @id @default(autoincrement())
  uuid         String      @unique
  isActive     Boolean     @default(true)
  finalizedAt  DateTime?   // üëà quando o cliente finaliza
  supermarket  Supermarket @relation(fields: [supermarketId], references: [id])
  supermarketId Int
  items        CartItem[]
  ruptures     Rupture[]
  createdAt    DateTime    @default(now())
}

model CartItem {
  id             Int      @id @default(autoincrement())
  product        Product  @relation(fields: [productId], references: [id])
  productId      Int
  cart           Cart     @relation(fields: [cartId], references: [id])
  cartId         Int
  quantity       Int      @default(1)
  observedPrice  Float?   // üëà pre√ßo visto pelo cliente
  subtotal       Float    @default(0)
  createdAt      DateTime @default(now())
}




// Ruptura comunit√°ria (cliente marcou ‚Äún√£o encontrei‚Äù)
model Rupture {
  id           Int       @id @default(autoincrement())
  cartId       Int
  productId    Int?
  note         String?
  productName  String?   // üëà adiciona este campo
  createdAt    DateTime  @default(now())

  cart     Cart     @relation(fields: [cartId], references: [id])
  product  Product? @relation(fields: [productId], references: [id])
}


